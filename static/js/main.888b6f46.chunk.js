(this["webpackJsonpmusic-share"]=this["webpackJsonpmusic-share"]||[]).push([[0],{139:function(e,t,n){e.exports=n(178)},168:function(e,t,n){},178:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(17),l=n.n(i),o=n(23),c=n(208),u=n(211),s=n(212),m=n(130),d=n(213),g=Object(c.a)((function(e){return{title:{marginLeft:e.spacing(2)}}})),p=function(){var e=g();return r.a.createElement(u.a,{color:"primary",position:"fixed"},r.a.createElement(s.a,null,r.a.createElement(d.a,null),r.a.createElement(m.a,{variant:"h6",component:"h1",className:e.title},"Music Share")))},b=n(75),f=n(24),h=n(62),v=n.n(h),S=n(91),E=n(241),y=n(214),O=n(215),j=n(239),x=n(216),w=n(217),N=n(218),C=n(219),I=n(220),q=n(76),k=n.n(q),_=n(89),P=n.n(_),F=n(88),T=n.n(F),A=n(18),Q=n(41);function R(){var e=Object(Q.a)(["\nmutation addSong($title: String!, $artist: String!, $duration: Float!, $thumbnail: String!, $url: String!) {\n  insert_music(objects: {title: $title, artist: $artist, duration: $duration, thumbnail: $thumbnail, url: $url}) {\n    affected_rows\n  }\n}\n"]);return R=function(){return e},e}function $(){var e=Object(Q.a)(["\n  mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]);return $=function(){return e},e}var G=Object(A.gql)($()),M=Object(A.gql)(R()),D=Object(c.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),J={duration:0,title:"",artist:"",thumbnail:""},L=function(){var e=D(),t=Object(a.useState)(""),n=Object(o.a)(t,2),i=n[0],l=n[1],c=Object(a.useState)(!1),u=Object(o.a)(c,2),s=u[0],m=u[1],d=Object(a.useState)(!1),g=Object(o.a)(d,2),p=g[0],h=g[1],q=Object(a.useState)(J),_=Object(o.a)(q,2),F=_[0],Q=_[1],R=Object(A.useMutation)(M),$=Object(o.a)(R,2),G=$[0],L=$[1].error;Object(a.useEffect)((function(){m(P.a.canPlay(i)||T.a.canPlay(i))}),[i]);var B=function(){h(!1)},U=function(){var e=Object(S.a)(v.a.mark((function e(){var t,n,a,r,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=F.url,n=F.thumbnail,a=F.duration,r=F.title,i=F.artist,e.next=4,G({variables:{url:t.length>0?t:null,thumbnail:n.length>0?n:null,duration:a>0?a:null,title:r.length>0?r:null,artist:i.length>0?i:null}});case 4:B(),Q(J),l(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.dir(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(S.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}r=W(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,Y(a);case 9:r=e.sent;case 10:Q(Object(f.a)(Object(f.a)({},r),{},{url:i}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,r=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(r,"/0.jpg")}},Y=function(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumnnail:e.artwork_url.replace("-large","-t500x500")})}))}))},V=function(e){Q(Object(f.a)(Object(f.a)({},F),{},Object(b.a)({},e.target.name,e.target.value)))},H=function(e){var t,n,a;return null===L||void 0===L||null===(t=L.graphQLErrors[0])||void 0===t||null===(n=t.extensions)||void 0===n||null===(a=n.path)||void 0===a?void 0:a.includes(e)},K=F.thumbnail,X=F.title,Z=F.artist;return r.a.createElement("div",{className:e.container},r.a.createElement(E.a,{className:e.dialog,open:p,onClose:B},r.a.createElement(y.a,null,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443"),r.a.createElement(O.a,null,r.a.createElement("img",{className:e.thumbnail,src:K,alt:X}),r.a.createElement(j.a,{margin:"dense",name:"title",label:"Title",fullWidth:!0,value:X,onChange:V,error:H("title"),helperText:H("title")&&"Fill out the field"}),r.a.createElement(j.a,{margin:"dense",name:"artist",label:"Artist",fullWidth:!0,value:Z,onChange:V,error:H("artist"),helperText:H("tiartisttle")&&"Fill out the field"}),r.a.createElement(j.a,{margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,value:K,onChange:V,error:H("thumbnail"),helperText:H("thumbnail")&&"Fill out the field"})),r.a.createElement(x.a,null,r.a.createElement(w.a,{onClick:B,color:"secondary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(w.a,{onClick:U,variant:"outlined",color:"primary"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443"))),r.a.createElement(j.a,{onChange:function(e){return l(e.target.value)},value:i,className:e.urlInput,placeholder:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 URL-\u0430\u0434\u0440\u0435\u0441 Youtube \u0438\u043b\u0438 Soundcloud",fullWidth:!0,margin:"normal",type:"url",inputProps:{startAdornment:r.a.createElement(N.a,null,r.a.createElement(C.a,null))}}),r.a.createElement(w.a,{className:e.addSongButton,variant:"contained",color:"primary",endIcon:r.a.createElement(I.a,null),onClick:function(){return h(!0)},disabled:!s},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"),r.a.createElement(k.a,{url:i,hidden:!0,onReady:z}))},B=n(221),U=n(222),z=n(223),W=n(224),Y=n(225),V=n(226),H=n(227),K=n(228),X=n(229);function Z(){var e=Object(Q.a)(["\nsubscription getSongs {\n  music(order_by: {created_at: desc}) {\n    artist\n    created_at\n    duration\n    id\n    thumbnail\n    title\n    url\n  }\n}\n"]);return Z=function(){return e},e}var ee=Object(A.gql)(Z()),te=Object(c.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{width:140,height:140}}})),ne=function(e){var t=e.song,n=te(),i=Object(A.useMutation)(G,{onCompleted:function(e){localStorage.setItem("queuedSongs",JSON.stringify(e.addOrRemoveFromQueue))}}),l=Object(o.a)(i,1)[0],c=Object(a.useContext)(Se),u=c.state,s=c.dispatch,d=Object(a.useState)(!1),g=Object(o.a)(d,2),p=g[0],b=g[1],h=t.title,v=t.artist,S=t.thumbnail;Object(a.useEffect)((function(){var e=u.isPlaying&&t.id===u.song.id;b(e)}),[t.id,u.song.id,u.isPlaying]);return r.a.createElement(U.a,{className:n.container},r.a.createElement("div",{className:n.songInfoContainer},r.a.createElement(z.a,{className:n.thumbnail,image:S}),r.a.createElement("div",{className:n.songInfo},r.a.createElement(W.a,null,r.a.createElement(m.a,{gutterBottom:!0,variant:"h5",component:"h2"},h),r.a.createElement(m.a,{variant:"body1",component:"p",color:"textSecondary"},v)),r.a.createElement(Y.a,null,r.a.createElement(V.a,{size:"small",color:"primary",onClick:function(){s({type:"SET_SONG",payload:{song:t}}),s(u.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})}},p?r.a.createElement(H.a,null):r.a.createElement(K.a,null)),r.a.createElement(V.a,{size:"small",color:"secondary",onClick:function(){l({variables:{input:Object(f.a)(Object(f.a)({},t),{},{__typename:"Song"})}})}},r.a.createElement(X.a,null))))))},ae=function(){var e=Object(A.useSubscription)(ee),t=e.loading,n=e.error,a=e.data;return t?r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50}},r.a.createElement(B.a,null)):n?r.a.createElement("div",null,"Error"):r.a.createElement("div",null,a.music.map((function(e){return r.a.createElement(ne,{key:e.id,song:e})})))},re=n(231),ie=n(243),le=n(232),oe=n(233);function ce(){var e=Object(Q.a)(["\n  query getQueuedSongs {\n    queuedSongs @client {\n      id,\n      duration,\n      title,\n      artist,\n      thumbnail,\n      url\n    }\n  }\n"]);return ce=function(){return e},e}var ue=Object(A.gql)(ce()),se=n(242),me=n(230),de=Object(c.a)({avatar:{width:44,height:44,marginRight:15},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"flex",alignItems:"center",marginTop:10},songInfoContainer:{flex:"1 1 auto",overflow:"hidden",whiteSpace:"nowrap"}});function ge(e){var t=e.song,n=de(),a=Object(A.useMutation)(G,{onCompleted:function(e){localStorage.setItem("queuedSongs",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(o.a)(a,1)[0],l=t.title,c=t.artist,u=t.thumbnail;return r.a.createElement("div",{className:n.container},r.a.createElement(se.a,{className:n.avatar,src:u,alt:"Song thumbnail"}),r.a.createElement("div",{className:n.songInfoContainer},r.a.createElement(m.a,{className:n.text,variant:"subtitle2"},l),r.a.createElement(m.a,{className:n.text,color:"textSecondary",variant:"body2"},c)),r.a.createElement(V.a,{onClick:function(){i({variables:{input:Object(f.a)(Object(f.a)({},t),{},{__typename:"Song"})}})}},r.a.createElement(me.a,{color:"error"})))}var pe=function(e){var t=e.queuedSongs;return console.log({queuedSongs:t}),r.a.createElement("div",{style:{margin:"10px 0"}},r.a.createElement(m.a,{color:"textSecondary",variant:"button"},"\u041c\u043e\u0438 \u0430\u0443\u0434\u0438\u043e\u0437\u0430\u043f\u0438\u0441\u0438 (",t.length,")"),t.map((function(e,t){return r.a.createElement(ge,{key:t,song:e})})))},be=Object(c.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{width:38,height:38}}})),fe=function(){var e=Object(A.useQuery)(ue).data,t=Object(a.useRef)(),n=Object(a.useContext)(Se),i=n.state,l=n.dispatch,c=Object(a.useState)(0),u=Object(o.a)(c,2),s=u[0],d=u[1],g=Object(a.useState)(!1),p=Object(o.a)(g,2),b=p[0],f=p[1],h=Object(a.useState)(0),v=Object(o.a)(h,2),S=v[0],E=v[1],y=Object(a.useState)(0),O=Object(o.a)(y,2),j=O[0],x=O[1],w=be(),N=Object(re.a)((function(e){return e.breakpoints.up("md")}));Object(a.useEffect)((function(){var t=e.queuedSongs.findIndex((function(e){return e.id===i.song.id}));x(t)}),[e.queuedSongs,i.song.id]),Object(a.useEffect)((function(){var t=e.queuedSongs[j+1];s>=.99&&t&&(d(0),l({type:"SET_SONG",payload:{song:t}}))}),[e.queuedSongs,s,l,j]);return r.a.createElement(a.Fragment,null,r.a.createElement(U.a,{className:w.container,variant:"outlined"},r.a.createElement("div",{className:w.details},r.a.createElement(W.a,{className:w.content},r.a.createElement(m.a,{variant:"h5",component:"h3"},i.song.title),r.a.createElement(m.a,{variant:"subtitle1",component:"p",color:"textSecondary"},i.song.artist)),r.a.createElement("div",{className:w.controls},r.a.createElement(V.a,{onClick:function(){var t=e.queuedSongs[j-1];t&&l({type:"SET_SONG",payload:{song:t}})}},r.a.createElement(le.a,null)),r.a.createElement(V.a,{onClick:function(){l(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})}},i.isPlaying?r.a.createElement(H.a,{className:w.playIcon}):r.a.createElement(K.a,{className:w.playIcon})),r.a.createElement(V.a,{onClick:function(){var t=e.queuedSongs[j+1];t&&l({type:"SET_SONG",payload:{song:t}})}},r.a.createElement(oe.a,null)),r.a.createElement(m.a,{variant:"subtitle1",component:"p",color:"textSecondary"},new Date(1e3*S).toISOString().substr(11,8))),r.a.createElement(ie.a,{type:"range",min:0,max:1,step:.01,value:s,onMouseDown:function(){f(!0)},onMouseUp:function(){f(!1),t.current.seekTo(s)},onChange:function(e,t){d(t)}})),r.a.createElement(k.a,{ref:t,onProgress:function(e){var t=e.played,n=e.playedSeconds;b||(d(t),E(n))},url:i.song.url,playing:i.isPlaying,hidden:!0}),r.a.createElement(z.a,{className:w.thumbnail,image:i.song.thumbnail})),N&&r.a.createElement(pe,{queuedSongs:e.queuedSongs}))},he=n(234),ve=(n(168),function(e,t){switch(t.type){case"PLAY_SONG":return Object(f.a)(Object(f.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(f.a)(Object(f.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(f.a)(Object(f.a)({},e),{},{song:t.payload.song});default:return e}}),Se=r.a.createContext({song:{id:"adc1333d-a4ca-4a33-ac21-f0ee730b90b8",title:"Madcon",artist:"Beggin",thumbnail:"http://img.youtube.com/vi/zrFI2gJSuwA/0.jpg",url:"https://www.youtube.com/watch?v=zrFI2gJSuwA&ab_channel=oficialmadcon",duration:224},isPlaying:!1});var Ee=function(){var e=r.a.useContext(Se),t=r.a.useReducer(ve,e),n=Object(o.a)(t,2),a=n[0],i=n[1],l=Object(re.a)((function(e){return e.breakpoints.up("md")}));return r.a.createElement(Se.Provider,{value:{state:a,dispatch:i}},r.a.createElement(p,null),r.a.createElement(he.a,{container:!0,spacing:3,style:{marginTop:"80px"}},r.a.createElement(he.a,{item:!0,xs:12,md:7},r.a.createElement(L,null),r.a.createElement(ae,null)),r.a.createElement(he.a,{style:l?{position:"fixed",width:"100%",right:"17px",top:"70px"}:{position:"fixed",width:"100%",left:"0",bottom:"0"},item:!0,xs:12,md:5},r.a.createElement(fe,null))))},ye=n(237),Oe=n(238),je=n(127),xe=n(124);function we(){var e=Object(Q.a)(["\n    type Song {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      url: String!\n      duration: Float!\n    }\n\n    input SongInput {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      url: String!\n      duration: Float!\n    }\n\n    type Query {\n      queuedSongs: [Song]!\n    }\n\n    type Mutation {\n      addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n  "]);return we=function(){return e},e}var Ne=new A.ApolloClient({link:new xe.a({uri:"wss://music.hasura.app/v1/graphql",options:{reconnect:!0}}),cache:new A.InMemoryCache,typeDefs:Object(A.gql)(we()),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,r=n.cache,i=r.readQuery({query:ue});if(i){var l=i.queuedSongs,o=l.some((function(e){return e.id===a.id}))?l.filter((function(e){return e.id!==a.id})):[].concat(Object(je.a)(l),[a]);return r.writeQuery({query:ue,data:{queuedSongs:o}}),o}return[]}}}}),Ce={queuedSongs:Boolean(localStorage.getItem("queuedSongs"))?JSON.parse(localStorage.getItem("queuedSongs")):[]};Ne.writeQuery({query:ue,data:Ce});var Ie=Ne,qe=n(126),ke=n(235),_e=n(236),Pe=Object(qe.a)({palette:{type:"dark",primary:ke.a,secondary:_e.a}});l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(A.ApolloProvider,{client:Ie},r.a.createElement(ye.a,{theme:Pe},r.a.createElement(Oe.a,null),r.a.createElement(Ee,null)))),document.getElementById("root"))}},[[139,1,2]]]);
//# sourceMappingURL=main.888b6f46.chunk.js.map